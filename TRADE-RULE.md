# temp
# トレードルール


# マーク・ミネルビニ流 成長株投資フレームワークまとめ

## 1. ステージ理論とは何か（定義）

**ステージ理論（Stage Analysis）**とは、  
株価の長期トレンドを「4つの状態（ステージ）」に分類し、  
**第2ステージ以外では一切リスクを取らない**ための市場認識フレームワークである。

本質はシンプルで、

> **「大きく勝てるのは、構造的な上昇トレンドに入った銘柄だけ」**

という事実を、感情ではなく**客観条件**で判定するための理論。

---

## 2. 各ステージの定義と判定基準

### ステージ1：ベース形成期（Stage 1 – Base）

**定義**
- 下落トレンドが止まり、横ばいでエネルギーを溜めている段階
- まだ「上昇トレンド」とは言えない

**特徴**
- 200日移動平均線（MA）が横ばい
- 株価は200日MA付近を上下
- 出来高は低調
- 強気材料と弱気材料が混在

**投資判断**
- ❌ 買わない  
- 理由：  
  → 上にも下にも行き得る「未確定ゾーン」

---

### ステージ2：上昇期（Stage 2 – Advancing）

**定義**
- 機関投資家の資金流入により、**持続的な上昇トレンドが確立した状態**

**客観的条件（トレンドテンプレート）**
- 株価 ＞ 150日MA ＞ 200日MA
- 200日MAが明確な上昇トレンド
- 50日MAが150日・200日MAの上
- 52週高値の25%以内
- 52週安値から30%以上上昇
- RS（相対力）70以上（理想80〜90）

**投資判断**
- ✅ 唯一「買ってよい」ステージ  
- 全リスクはこのステージに集中させる

---

### ステージ3：天井形成期（Stage 3 – Topping）

**定義**
- 上昇トレンドが鈍化し、分配（Distribution）が始まる段階

**特徴**
- 200日MAが横ばい化
- 高値更新できなくなる
- 出来高を伴う乱高下
- 機関投資家の静かな売り抜け

**投資判断**
- ❌ 新規エントリー禁止  
- 保有中なら警戒モード

---

### ステージ4：下落期（Stage 4 – Declining）

**定義**
- 明確な下落トレンドに入った状態

**特徴**
- 株価 ＜ 200日MA
- 200日MAが下向き
- デッドクロス頻発
- 出来高を伴う急落

**投資判断**
- ❌ 絶対に買わない  
- ❌ 「安値拾い」は禁止  
- 速やかに撤退

---

## 3. ステージ遷移で何が起きているか

### ステージ1 → ステージ2
- 機関投資家が本格的に買い始める
- 200日MAが上向きに転換
- 出来高増加＋高値更新

👉 **唯一の狙うべき変化**

---

### ステージ2 → ステージ3
- 上昇の勢いが鈍化
- 良いニュースでも上がらない
- 出来高増で伸びない

👉 **分配開始のサイン**

---

### ステージ3 → ステージ4
- サポート割れ
- MA下抜け＋出来高増

👉 **完全撤退フェーズ**

---

## 4. エントリーポイント（買いの技術）

### 原則
- **ブレイクアウトのみ**
- 押し目・底値狙いはしない

### 代表的なエントリー
- カップウィズハンドルの高値ブレイク
- タイトなベースからの上放れ
- 出来高増加を伴う高値更新

---

## 5. リスク管理（最重要）

### 1トレードあたりの損失制限
- **最大損失：10%**
- **理想的平均損失：5〜6%**

理由：
- 50%の損失＝100%の回復が必要  
- 小さな損失だけが複利を守る

---

### 損切りルール
- **エントリー前に必ず損切り位置を決める**
- 触れたら即実行
- 解釈・期待・希望は一切禁止

---

### リスク・リワード比
- 最低 **1 : 3**
- 5%損失 → 15%以上の利益を狙える形のみ

---

## 6. ポジションサイズ

- 1トレードの損失額が  
  **総資産の1%前後**に収まるよう調整
- 不確実性が高いほどサイズは小さく

---

## 7. 利益確定（出口戦略）

### 基本原則
- 大勝ちを逃さない
- 小さな勝ちで満足しない

### 実践
- 20〜25%上昇で一部利確も可
- トレンド継続中は保有
- 50日MA割れなどで警戒

---

## 8. 損切り・撤退の思想

### 最重要概念：「不本意な投資家」
- 損切りできずに長期保有へ転落した状態
- 最大の罪

### 思考フレーム
- トレードは確率の1試行
- 負けは「保険料」
- 市場に正しさを証明する必要はない

---

## 9. 全体の黄金律（要約）

- 資本保護はコストではなく、利益の源泉
- 第2ステージ以外では取引しない
- 買う前に出口を決める
- 小さく負けて、大きく勝つ
- 規律を守った自分を評価せよ


---------------------------------
リスク管理基準書：資本保護と並外れたリターンを維持するための規律ある行動指針
1. イントロダクション：リスク管理の戦略的意義
トレーディングにおけるリスク管理とは、単なる資産の「防御策」ではない。それは、長期にわたって「並外れたリターン（Super Performance）」を叩き出し続けるための唯一のエンジンである。市場において、凡庸な投資家はいかに稼ぐかに執着するが、真のプロフェッショナルは「いかに資本を守り抜くか」を全思考の出発点とする。本基準書の根幹にあるのは、チャンピオン投資家に共通する**「失わない限り、相場で得た利益は自分のお金である」**という冷徹な原則である。損失を「授業料」という感傷的な言葉で片付けてはならない。損失とは数学的に定義され、厳格に「制御されるべき変数」である。我々の目的は、勝率を競うことではなく、微小な損失と巨大な利益の「非対称性」を維持することにある。資本という弾薬を枯渇させた者に、次の勝利を語る資格はない。資本保護という規律こそが、複利の爆発力を解放し、並外れた富を築くための絶対的な土台となる。以下に、プロフェッショナルとして遵守すべき執行プロトコルを定義する。
2. 執行前のリスク定義プロトコル
トレードの成否は、注文を執行する前の「準備」で決定される。感情が介在する余地を完全に排除するため、以下のプロトコルを例外なく義務付ける。
2.1 許容リスクの数学的根拠
投資家が最も避けるべきは、資産の「壊滅的打撃」である。以下の表は、損失を放置することがいかに致命的であるかを証明している。| 損失率 | 回復に必要な上昇率 || ------ | ------ || 10% | 11.1% || 20% | 25% || 33% | 50% || 50% | 100% |
50%の損失を出せば、元の資本に戻すだけで100%のリターンが必要となる。この数学的事実に基づき、一回のトレードにおける**最大損切りラインは10%**に固定し、 平均損失は5〜6%以内 に抑えることを厳命する。
2.2 損切りストップの事前設定
エントリーは、出口（損切りポイント）が確定するまで厳格に禁止される。これは「市場がいつ、自分の判断が間違っていると審判を下すか」を事前に定義する作業である。株価が損切りラインに達した際、そこに一切の解釈や希望的観測を挟むことは許されない。
2.3 リスク・リワード比の最適化
期待される利益が、許容する損失の少なくとも3倍以上（リスク・リワード比 1:3）である場合にのみ資金を投じる。平均損失を5%に抑え、平均利益15%を維持すれば、勝率が50%であっても資産は幾何級数的に増加する。事前のルール設定こそが、不確実な相場における唯一の防壁となる。
3. 損切りの心理的障壁を打破する思考法
投資家が直面する最大の敵は市場ではなく、自らの「エゴ」である。プロフェッショナルとして生き残るために、以下の認識を脳裏に刻み込まなければならない。
エゴと利益の分離:  投資の目的は「自分の正しさを証明すること」ではなく「利益を上げること」である。「メンツを保ちたいのか、それとも利益を上げたいのか？」という問いを常に自問せよ。市場に対して謙虚であれ。
確率論的思考:  トレードを単発の勝負と考えてはならない。それは「100万回の試行のうちの1回」に過ぎない。個別の負けは、正しいプロセスを執行した結果としての「規律ある敗北」であり、成功への必要経費（保険料）である。
「不本意な投資家」という大罪:  損切りを拒み、「いつか戻るだろう」と自分を欺き始めた瞬間、トレーダーは「不本意な投資家」へと転落する。これは心理的な防御メカニズムが生んだ最悪の逃避であり、投資家にとっての「最大の罪」である。小さな間違いが「本物の間違い」に変わる前に、直ちに処理せよ。
4. 市場サイクル（ステージ分析）に基づくリスク調整
個別銘柄の分析以上に、市場の「ステージ」を客観的に認識することがリスク軽減に直結する。SEPA戦略に基づき、以下の基準を投資判断のゲートキーパーとする。
4.1 トレンドテンプレート（第2ステージの特定）
第2ステージ（上昇局面）にない銘柄への投資は、いかなる理由があっても禁止する。以下の「トレンドテンプレート」の全条件を満たすものだけが、監査対象となる。
現在の株価が150日および200日移動平均線（MA）を上回っている。
150日MAが200日MAを上回っている。
200日MAが少なくとも1ヶ月以上（理想的には4〜5ヶ月）上昇トレンドにある。
50日MAが150日および200日MAを上回っている。
現在の株価が52週安値から少なくとも30%以上高い。
現在の株価が52週高値から25%以内にある。
レラティブストレングス（RS）ランキングが70以上、理想的には80〜90代である。
4.2 第4ステージ（下落局面）の回避
第4ステージにおける「安値拾い」はポーカーのトラップと同様であり、資産を破壊する最短の道である。出来高を伴う急落や移動平均線のデッドクロスは、機関投資家が売り抜けている「重大な警告」である。耳に入る噂ではなく、目に見える事実のみを信じ、直ちに撤退せよ。
5. 規律ある執行と継続的な改善
トレーディングは感情の産物ではなく、高度に管理された「プロセス」である。
記録と監査:  全てのトレードを記録し、客観的に分析せよ。特に「手法の失敗（Normal Stop Out）」と「規律の失敗（Violation of Rules）」を峻別すること。手法の欠陥は改善できるが、規律の欠陥は破滅を招く。
完璧主義の排除:  トレーディングは永遠に完璧にはならない。しかし、規律を守ることは今この瞬間から可能である。正しいプロセスを継続した結果としての損失は、成功への足場となる。
投資家としての品格:  感情を排し、統計的優位性のみに基づいて執行する姿勢こそが、投資家としての品格と長期的な富を形成する。
リスク管理の黄金律
資本保護はコストではない。それこそが利益の源泉である。
買う前に「出口」を決定し、いかなる例外も認めず執行せよ。
トレンドテンプレートに合致しない銘柄（非第2ステージ）は、投資対象から除外する。
「不本意な投資家」になるな。間違いを認める勇気が、致命的な損失を防ぐ。
結果ではなく、規律あるプロセスを継続した自分を称賛せよ。本基準書の執行こそが、市場の荒波を生き抜き、並外れたリターンを永続させるための唯一の道である。


code
ロジック開発フロー
1) Pythonでロジックをそのまま実装・バックテスト（パラメータ同定）  
2) TradingViewのPine Scriptで可視化・アラート化（現場検証） 


---
以下は、提示内容をコード化できるように数式・閾値で定義した「ミネルヴィニ流ステージ理論＋VCP＋SEPAに基づく厳格なロング専用トレードルール」です。各数値はデフォルト値として実装可能なものに固定しています（必要に応じてパラメータ化してください）。  
  
変数定義（日足ベース）  
- Close[t], High[t], Low[t], Open[t], Volume[t]  
- SMA_n[t] = n日単純移動平均（価格）  
- EMA_n[t] = n日指数移動平均（価格）  
- BB_Upper20_2[t] = SMA_20[t] + 2 × StdDev(Close, 20)  
- ATR14[t] = Average(TrueRange, 14)  
- AvgVol_10[t] = SMA(Volume, 10), AvgVol_50[t] = SMA(Volume, 50)  
- High_52w[t] = 252日高値、Low_52w[t] = 252日安値  
- RS_Line[t] = Close[t] / BenchmarkIndexClose[t]（例：TOPIX、SPY）  
- RS_Line_52wHigh[t] = RS_Line[t] が過去252日で最高かの真偽  
- DistributionDay(Index): 当日の指数の下落率 ≤ −0.2% かつ Volume > 前日Volume  
- Slope200[t] = SMA_200[t] − SMA_200[t−20]（上向き判定）  
  
主要パラメータ（デフォルト）  
- BuyZonePct = 3%（ピボットからの許容乖離）  
- BreakoutVolRatio = 1.5（出来高が50日平均の1.5倍以上）  
- DryUpVolRatio = 0.6（ドライアップ判定＝10日平均が50日平均の60%以下）  
- ContractionPercSeq = [25%, 15%, 8%, 5%]（理想的収縮シーケンス）  
- LastContractionMax = 10%（直近収縮の最大幅）  
- InitialStopMaxPct = 7%（初期ストップ最大許容）  
- PivotBufferATR = 0.5 × ATR14（ストップのバッファ）  
- RiskPerTrade = 0.75%（口座資産に対する1トレードの許容損失）  
- MaxLossHard = 10%（硬い最大損失上限）  
- PartialSellBB = 25%（BB上限到達時の部分利確比率）  
- MinAvgDailyVolume = 500,000株（流動性フィルター）  
- RS_MinRating = 70（外部RSレーティングがある場合）  
- RS_LineNewHighRequired = true（RSラインが52週高値更新）  
- IndexDistDaysMax = 5（過去25日間のディストリビューションデー上限）  
- EarningsWindow = 3日（決算前後、新規エントリー縮小または回避）  
  
ステージ判定（ロングはStage 2のみ許可）  
- Stage 2（買い許可）  
  1) Close[t] > SMA_50[t] かつ SMA_50[t] > SMA_150[t] > SMA_200[t]  
  2) Slope200[t] > 0（少なくとも1カ月＝20営業日で上向き）  
  3) Close[t] ≥ Low_52w[t] × 1.30（52週安値から30%以上上昇）  
  4) Close[t] ≥ High_52w[t] × 0.75（52週高値までの距離25%以内）  
  5) 流動性：AvgVol_50[t] ≥ MinAvgDailyVolume  
  6) 相対力：RS_LineNewHighRequired = true または RS_MinRating以上  
- Stage 1（ベース）：SMA_200が横ばい（|Slope200| 小）で価格が200日線近辺のレンジ  
- Stage 3（天井）：CloseがHigh_52wに近いが高値更新できず、SMA_200横ばい、IndexのDistributionDay増加、価格の乱高下増加  
- Stage 4（下落）：Close[t] < SMA_200[t] かつ Slope200[t] < 0 かつ SMA_50[t] < SMA_200[t]  
  
スクリーニングルール  
- Stage 2条件を全て満たす銘柄のみ通過  
- ファンダ補助（有れば）：直近四半期EPS YoY ≥ 25%、売上YoY ≥ 25%、QoQ加速、ROE高水準、希薄化リスク低  
- セクターRS：セクターETFがSMA_50とSMA_200の上  
  
VCP（ボラティリティ収縮パターン）検出  
- ベース期間 L ∈ [35, 65]営業日で検出  
- Swing高安抽出後、連続3回以上の押し幅％が逓減（例：>=25%、>=15%、>=8%、最後<=LastContractionMax）  
- 直近の収縮区間で  
  - AvgVol_10[t] / AvgVol_50[t] ≤ DryUpVolRatio（ドライアップ）  
  - 平均TrueRangeの低下（ATR14[t] ≤ ATR14[t−20] × 0.8 など）  
- Pivot（レジスタンス）＝ベース最上部の水平高値（BaseHigh）  
- オーバーヘッド供給軽微：Pivot ≈ High_52w（Pivot ≥ High_52w × 0.95 を推奨）  
- ワイド＆ルース回避：ベース内の日次変動率の標準偏差が過去90日平均の1.2倍超なら不合格  
  
エントリー（標準ブレイクアウト）  
- 事前条件：市場環境良好（後述）、Stage 2、VCP品質合格、Pivot 定義済み  
- トリガー（いずれか）  
  1) 終値ベース：Close[t] ≥ Pivot かつ Volume[t] ≥ AvgVol_50[t] × BreakoutVolRatio  
  2) 場中ブレイク：High[t] ≥ Pivot かつ 終値がPivot以上で引け、Volume[t] ≥ AvgVol_50[t] × BreakoutVolRatio  
- 買いゾーン：エントリー価格 Entry ≤ Pivot × (1 + BuyZonePct)  
- 失敗防止：ブレイク日から3営業日以内にClose < Pivot かつ Volume ≥ AvgVol_50 × 1.2 → 全撤退（フェイルド・ブレイク）  
  
早期（チート）エントリー（任意）  
- ベース内の下降トレンドライン上抜けか、直近10日高値更新  
- Volume[t] ≥ AvgVol_50[t] × 1.2  
- ストップはよりタイト（下記初期ストップのうちより近い方）  
  
初期ストップ（注文前に固定）  
- 候補1：S1 = Pivot × (1 − 0.03)（ピボット−3%）  
- 候補2：S2 = LastContractionLow − PivotBufferATR  
- StopPrice = max(S1, S2)  
- StopDistancePct = (Entry − StopPrice) / Entry  
- 条件：StopDistancePct ≤ InitialStopMaxPct かつ ≤ MaxLossHard  
- 条件を満たさない場合は見送り  
  
ポジションサイズ計算  
- AccountEquity = 口座残高  
- AllowedLoss = AccountEquity × RiskPerTrade  
- Shares = floor(AllowedLoss / (Entry − StopPrice))  
- 約定単位・最小発注数量に合わせて丸め  
- ナンピン禁止。増し玉は含み益時のみ、追加セットアップ（ミニVCP、再圧縮）で、1回の追加につきRiskPerTradeの半分を上限  
  
利益確定・保有管理  
- 初動管理（ブレイク後30日以内）  
  - Close が EMA_21 を明確に下抜（Close < EMA_21 且つ Volume ≥ AvgVol_50 × 1.2）→ 50%縮小  
  - BB上限タッチ：Close ≥ BB_Upper20_2 → ポジションのPartialSellBB（25%）を利確  
- トレンド成熟管理  
  - 強制全撤退：Close ≤ SMA_50（下落して50日線に「終値で触れた」判定）→ 100%売却  
  - 10週線相当のSMA_50週や日足SMA_50をトレイルする場合、終値割れで段階的利確でも可（ただし「50日線タッチで全て売却」を主軸にしたい場合はこの限りではない）  
- 段階利食い（任意）：Entryから+20〜25%到達 → 1/3利確、残りはSMA_50割れまで保有  
- 過熱警戒：3連続大陽線で日次騰落率平均≥+3%かつ Volume拡張（AvgVol_50×1.5）→ 25%利確  
  
撤退・異常動作  
- フェイルドブレイク（上記）で即撤退  
- 異常陰線：  
  - DownRange = (Close − Open)/Open ≤ −2% かつ Volume ≥ AvgVol_50×1.5 → 全撤退  
  - ギャップダウン（Open ≤ Close[t−1] × 0.97）かつ Close < Pivot → 全撤退  
- 市場イベント：  
  - 決算予定まで EarningsWindow（3日）以内に新規エントリー禁止、保有サイズは50%に縮小を推奨  
  
マーケット環境フィルター（指数・セクター）  
- 主要指数（例：SPY, QQQ, TOPIXなど）が  
  - Close > SMA_50 かつ Close > SMA_200  
  - 過去25営業日のDistributionDay数 ≤ IndexDistDaysMax  
- セクターETFが Close > SMA_50 かつ SMA_200上向き  
- 条件不成立時は新規エントリー禁止。保有銘柄はサイズ縮小またはキャッシュ比率増加  
  
相関・エクスポージャー管理  
- 同一セクター保有は最大2銘柄、総エクスポージャーはAccountEquityの60%を上限（地合いが極めて良好なら上限80%まで可）  
- 個別銘柄のGap/Earningsイベントが重なる場合は合計リスクを半減  
  
よくある落とし穴（機械判定）  
- ベースの価格標準偏差が過去90日平均の1.2倍超 → ワイド＆ルースで不合格  
- PivotがHigh_52wから遠い（Pivot < High_52w × 0.9） → 上値供給過多の可能性  
- ブレイクの出来高不足（Volume < AvgVol_50 × BreakoutVolRatio） → 見送り  
  
実行フロー（擬似コード）  
1) スクリーニング  
- If not Stage2 or AvgVol_50 < MinAvgDailyVolume or RS条件不成立: reject  
- If Index環境条件不成立: reject  
  
2) VCP検出  
- Find base over L∈[35,65] days  
- Check contraction sequence decreasing and LastContraction ≤ LastContractionMax  
- Check DryUp: AvgVol_10/AvgVol_50 ≤ DryUpVolRatio  
- Set Pivot = max(High over base)  
- If Pivot < High_52w×0.95 or base volatility too wide: reject  
  
3) 事前計画  
- Entry = Pivot（または場中ブレイク判定時の約定価格）  
- Compute StopPrice = max(Pivot×(1−0.03), LastContractionLow − 0.5×ATR14)  
- If (Entry − StopPrice)/Entry > InitialStopMaxPct or > MaxLossHard: reject  
- Shares = floor((AccountEquity×RiskPerTrade)/(Entry − StopPrice))  
  
4) 執行  
- If Close ≥ Pivot and Volume ≥ AvgVol_50×BreakoutVolRatio and Entry ≤ Pivot×(1+BuyZonePct): buy Shares  
- Else if intraday break confirmed with on-close check: buy at close  
  
5) 管理  
- If Close < Pivot within 3 days and Volume ≥ AvgVol_50×1.2: exit all  
- If Close ≥ BB_Upper20_2: sell PartialSellBB% of position  
- If Close ≤ EMA_21 and Volume ≥ AvgVol_50×1.2: sell 50%  
- If Close ≤ SMA_50: exit all  
- If AbnormalDown or GapDown below Pivot: exit all  
  
6) 追加エントリー（含み益時のみ）  
- If after breakout a 5〜10日タイトレンジ形成（ATR14低下、AvgVol_10/AvgVol_50 ≤ 0.7）かつレンジ上抜けで Volume ≥ AvgVol_50×1.2: add position （RiskPerTradeの半分上限）  
- 新たなStopPriceは全体の加重平均Entryに対する同様のルールで再計算  
  
7) イベント管理  
- If earnings within 3 days: no new buys; reduce existing position by 50%  
  
補足（実装上の代替）  
- RSレーティングが取得できない場合はRS_Lineの52週高値更新で代替  
- Pivotの自動抽出が難しい場合は「ベース最終10日の最高終値」を暫定Pivotに設定  
- ドライアップ判定は出来高比率に加え、日次レンジ比（日次TrueRange/Close）の20日平均が過去20日から20%以上低下で補強  
- BuyZonePctは銘柄ボラで調整可能（例：ATR14/Entryが高い場合は5%まで拡張）  
  
このルールセットは、そのままコードへ落とし込み可能な数値条件・ロジックのみで構成してあります。パラメータは環境や市場によって最適値が異なるため、バックテストでチューニングしてください。  
